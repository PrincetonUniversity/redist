<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tidy `redist` • redist</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tidy `redist`">
<meta property="og:description" content="redist">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">redist</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Intro-to-redist.html">Intro-to-redist</a>
    </li>
    <li>
      <a href="../articles/tidy-redist.html">Tidy `redist`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kosukeimai/redist/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="tidy-redist_files/header-attrs-2.6.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tidy <code>redist</code>
</h1>
            
            <h4 class="date">2021-03-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kosukeimai/redist/blob/master/vignettes/tidy-redist.Rmd"><code>vignettes/tidy-redist.Rmd</code></a></small>
      <div class="hidden name"><code>tidy-redist.Rmd</code></div>

    </div>

    
    
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>We begin by loading <code>tidyverse</code> and the <code>redist</code> library, and reading in our shapefile.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">redist</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">east_tx</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">east_tx</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 3138 features and 13 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -414696.7 ymin: 310898.7 xmax: 237123.4 ymax: 993178.7</span>
<span class="co">#&gt; projected CRS:  NAD83 / Conus Albers</span>
<span class="co">#&gt; # A tibble: 3,138 x 14</span>
<span class="co">#&gt;    county id                        geometry    cd   pop black  hisp white   vap</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt;           &lt;MULTIPOLYGON [m]&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 029    48029… (((-225344.9 724204.5, -22…    28   355    29   127   178   291</span>
<span class="co">#&gt;  2 029    48029… (((-221901.9 718229.7, -22…    28   153    31    87    20    29</span>
<span class="co">#&gt;  3 029    48029… (((-221901.2 716816.7, -22…    28   958   164   297   440   643</span>
<span class="co">#&gt;  4 029    48029… (((-225942 703767.3, -2256…    28  3895   174  1126  2528  2931</span>
<span class="co">#&gt;  5 029    48029… (((-224111.1 703124.3, -22…    28  1588    40   371  1165  1227</span>
<span class="co">#&gt;  6 029    48029… (((-229268.4 701654.1, -22…    28   328     3    93   230   276</span>
<span class="co">#&gt;  7 029    48029… (((-226356.7 715765.3, -22…    28  7499  2274  3220  1581  4829</span>
<span class="co">#&gt;  8 029    48029… (((-224091.7 715995.9, -22…    28    10     1     3     6     8</span>
<span class="co">#&gt;  9 029    48029… (((-231919.2 706761.5, -23…    28  1087   251   655   157   787</span>
<span class="co">#&gt; 10 029    48029… (((-217227.7 710079.4, -21…    28    54     7     8    39    45</span>
<span class="co">#&gt; # … with 3,128 more rows, and 5 more variables: bvap &lt;dbl&gt;, hvap &lt;dbl&gt;,</span>
<span class="co">#&gt; #   wvap &lt;dbl&gt;, dem &lt;int&gt;, gop &lt;int&gt;</span></code></pre></div>
</div>
<div id="specifying-the-redistricting-problem" class="section level1">
<h1 class="hasAnchor">
<a href="#specifying-the-redistricting-problem" class="anchor"></a>Specifying the Redistricting Problem</h1>
<p>The first thing we do is to create a <code>redist_map</code> object, which is essentially a data frame along with an adjacency graph and a little extra metadata about the redistricting problem at hand. It’s important to create this object early on, since data operations like filtering and summarizing will affect the graph structure, number of district, and population constraints.</p>
<p>Here, the existing district assignment is stored in the <code>cd</code> column. We provide let <code><a href="../reference/redist_map.html">redist_map()</a></code> know about this by providing the <code>existing_col</code> argument, and we use <code><a href="https://rdrr.io/r/base/Extremes.html">max(cd)</a></code> to count the total number of districts.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">east_tx_map</span> <span class="op">=</span> <span class="fu"><a href="../reference/redist_map.html">redist_map</a></span><span class="op">(</span><span class="va">east_tx</span>, pop_tol<span class="op">=</span><span class="fl">0.05</span>, existing_plan<span class="op">=</span><span class="va">cd</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">east_tx_map</span><span class="op">)</span>
<span class="co">#&gt; A redist_map object with 3138 units and 15 fields</span>
<span class="co">#&gt; To be partitioned into 15 districts with population between 698,224.4 - 5.0% and 698,224.4 + 5.0%</span>
<span class="co">#&gt; With geometry:</span>
<span class="co">#&gt;     bbox:           xmin: -414696.7 ymin: 310898.7 xmax: 237123.4 ymax: 993178.7</span>
<span class="co">#&gt;     projected CRS:  NAD83 / Conus Albers</span>
<span class="co">#&gt; # A tibble: 3,138 x 15</span>
<span class="co">#&gt;    county id                        geometry    cd   pop black  hisp white   vap</span>
<span class="co">#&gt;  * &lt;chr&gt;  &lt;chr&gt;           &lt;MULTIPOLYGON [m]&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 029    48029… (((-225344.9 724204.5, -22…    28   355    29   127   178   291</span>
<span class="co">#&gt;  2 029    48029… (((-221901.9 718229.7, -22…    28   153    31    87    20    29</span>
<span class="co">#&gt;  3 029    48029… (((-221901.2 716816.7, -22…    28   958   164   297   440   643</span>
<span class="co">#&gt;  4 029    48029… (((-225942 703767.3, -2256…    28  3895   174  1126  2528  2931</span>
<span class="co">#&gt;  5 029    48029… (((-224111.1 703124.3, -22…    28  1588    40   371  1165  1227</span>
<span class="co">#&gt;  6 029    48029… (((-229268.4 701654.1, -22…    28   328     3    93   230   276</span>
<span class="co">#&gt;  7 029    48029… (((-226356.7 715765.3, -22…    28  7499  2274  3220  1581  4829</span>
<span class="co">#&gt;  8 029    48029… (((-224091.7 715995.9, -22…    28    10     1     3     6     8</span>
<span class="co">#&gt;  9 029    48029… (((-231919.2 706761.5, -23…    28  1087   251   655   157   787</span>
<span class="co">#&gt; 10 029    48029… (((-217227.7 710079.4, -21…    28    54     7     8    39    45</span>
<span class="co">#&gt; # … with 3,128 more rows, and 6 more variables: bvap &lt;dbl&gt;, hvap &lt;dbl&gt;,</span>
<span class="co">#&gt; #   wvap &lt;dbl&gt;, dem &lt;int&gt;, gop &lt;int&gt;, adj &lt;list&gt;</span></code></pre></div>
<p>Our original shapefile stored its geographic information in terms of latitude and longitude. While common, this can cause problems for some of the geographic operations used in the analysis process, so by default <code><a href="../reference/redist_map.html">redist_map()</a></code> will reproject the shapefile geometry to a new coordinate system. Whether to do this and which coordinate system to use can be controlled using the <code>planarize</code> argument.</p>
<div id="subsetting" class="section level2">
<h2 class="hasAnchor">
<a href="#subsetting" class="anchor"></a>Subsetting</h2>
<p>Suppose that we want to focus our analysis on the Houston area, which for our purposes means the 2nd, 7th, 9th, 18th, 22nd, and 29th congressional districts. We can do this simply by using <code>dplyr</code>’s <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">houston_area</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">east_tx_map</span>, <span class="va">cd</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">7</span>, <span class="fl">9</span>, <span class="fl">18</span>, <span class="fl">22</span>, <span class="fl">29</span><span class="op">)</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">houston_area</span><span class="op">)</span>
<span class="co">#&gt; A redist_map object with 937 units and 15 fields</span>
<span class="co">#&gt; To be partitioned into 6 districts with population between 698,224.4 - 5.0% and 698,224.4 + 5.0%</span>
<span class="co">#&gt; With geometry:</span>
<span class="co">#&gt;     bbox:           xmin: -8610.921 ymin: 687624.4 xmax: 94290.38 ymax: 788347.1</span>
<span class="co">#&gt;     projected CRS:  NAD83 / Conus Albers</span>
<span class="co">#&gt; # A tibble: 937 x 15</span>
<span class="co">#&gt;    county id                        geometry    cd   pop black  hisp white   vap</span>
<span class="co">#&gt;  * &lt;chr&gt;  &lt;chr&gt;           &lt;MULTIPOLYGON [m]&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 039    48039… (((56463.9 723325.4, 57312…    22  9997  2808  1031  2925  6940</span>
<span class="co">#&gt;  2 039    48039… (((73701.52 703342.2, 7408…    22  3653   190  1061  2257  2718</span>
<span class="co">#&gt;  3 039    48039… (((69637.14 720067.7, 7093…    22  7263   591  1516  4691  4927</span>
<span class="co">#&gt;  4 039    48039… (((62778.08 723607.8, 6330…    22  5196   488  2015  2381  3828</span>
<span class="co">#&gt;  5 039    48039… (((63199.55 720686.6, 6644…    22  7303  1969  1761  2976  4991</span>
<span class="co">#&gt;  6 039    48039… (((68047.92 724871.3, 6910…    22  3791   188  1466  2006  2770</span>
<span class="co">#&gt;  7 039    48039… (((67244.84 719969, 67228.…    22  4816   541  1594  2454  3308</span>
<span class="co">#&gt;  8 039    48039… (((59370.14 715476.7, 5943…    22  5541   220  1501  3668  4165</span>
<span class="co">#&gt;  9 039    48039… (((55768.81 696116.4, 5564…    22  3947   282  1073  1979  2883</span>
<span class="co">#&gt; 10 039    48039… (((68627.5 711720.8, 69270…    22  6124   118  2131  3773  4463</span>
<span class="co">#&gt; # … with 927 more rows, and 6 more variables: bvap &lt;dbl&gt;, hvap &lt;dbl&gt;,</span>
<span class="co">#&gt; #   wvap &lt;dbl&gt;, dem &lt;int&gt;, gop &lt;int&gt;, adj &lt;list&gt;</span></code></pre></div>
<p>Behind the scenes, <code>redist</code> has adjusted the adjacency graph to remove the precincts that were filtered away. It has also adjusted the number of districts and the population bounds.</p>
<p>We can easily plot this new map, either by congressional district or by any other quantity of interest.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">houston_area</span>, edges<span class="op">=</span><span class="cn">F</span>, centroids<span class="op">=</span><span class="cn">F</span><span class="op">)</span> <span class="co"># hide the hundreds of graph edges and vertices</span></code></pre></div>
<p><img src="tidy-redist_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">houston_area</span>, <span class="va">hisp</span><span class="op">/</span><span class="va">pop</span><span class="op">)</span></code></pre></div>
<p><img src="tidy-redist_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
</div>
<div id="merging" class="section level2">
<h2 class="hasAnchor">
<a href="#merging" class="anchor"></a>Merging</h2>
<p>If we want to base our analysis on a geographical unit other than precincts, we use the <code><a href="../reference/merge_by.html">merge_by()</a></code> function, which calls <code>dplyr</code>’s <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> in the background. It also tries to intelligently summarize the other columns in the data frame—adding up the population in each county, for instance. By default, <code><a href="../reference/merge_by.html">merge_by()</a></code> will also group by the current congressional districts, if they are provided, to avoid erasing these lines.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">houston_counties</span> <span class="op">=</span> <span class="va">houston_area</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/merge_by.html">merge_by</a></span><span class="op">(</span><span class="va">county</span>, drop_geom<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">houston_counties</span><span class="op">)</span>
<span class="co">#&gt; A redist_map object with 9 units and 15 fields</span>
<span class="co">#&gt; To be partitioned into 6 districts with population between 698,224.4 - 5.0% and 698,224.4 + 5.0%</span>
<span class="co">#&gt; Merged from another map with reindexing: int [1:937] 6 6 6 6 6 ...</span>
<span class="co">#&gt; With geometry:</span>
<span class="co">#&gt;     bbox:           xmin: -8610.921 ymin: 687624.4 xmax: 94290.38 ymax: 788347.1</span>
<span class="co">#&gt;     projected CRS:  NAD83 / Conus Albers</span>
<span class="co">#&gt; # A tibble: 9 x 15</span>
<span class="co">#&gt; # Groups:   cd [6]</span>
<span class="co">#&gt;      cd county    pop  black   hisp  white    vap   bvap   hvap   wvap    dem</span>
<span class="co">#&gt; * &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;int&gt;</span>
<span class="co">#&gt; 1     2 201    705967  67459 217675 357581 523630  47485 142955 286983 114587</span>
<span class="co">#&gt; 2     7 201    699765  77708 211140 331256 520299  55540 141088 265013 124112</span>
<span class="co">#&gt; 3     9 157    145730  69603  39719  19598 102332  48129  25602  16358  34129</span>
<span class="co">#&gt; 4     9 201    552240 199127 221020  60303 398114 143132 144769  53043 102918</span>
<span class="co">#&gt; 5    18 201    690022 276331 266736 114318 499911 202616 172154 100367 146444</span>
<span class="co">#&gt; 6    22 039    156654  19318  40012  79274 110649  13319  25286  60040  24205</span>
<span class="co">#&gt; 7    22 157    439645  53664  99248 192082 309208  36848  63714 142711  73263</span>
<span class="co">#&gt; 8    22 201    105397  13045  33105  45417  77620   9176  21728  36830  14781</span>
<span class="co">#&gt; 9    29 201    695465  66741 531650  81193 469405  46629 341966  69148  92027</span>
<span class="co">#&gt; # … with 4 more variables: gop &lt;int&gt;, id &lt;chr&gt;, geometry &lt;GEOMETRY [m]&gt;,</span>
<span class="co">#&gt; #   adj &lt;list&gt;</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">houston_counties</span>, <span class="va">hisp</span><span class="op">/</span><span class="va">pop</span><span class="op">)</span></code></pre></div>
<p><img src="tidy-redist_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>We specify <code>drop_geom=FALSE</code> so that the shapefile geometries are also merged. Since this is a time-consuming process and is not necessary for redistricting analysis, by default <code><a href="../reference/merge_by.html">merge_by()</a></code> drops the shapefile geometry.</p>
<p>If more fine-grained control is needed than is provided by <code><a href="../reference/merge_by.html">merge_by()</a></code>, you can always use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>, which will still make the appropriate modifications to the adjacency graph.</p>
<p>Another common use of <code><a href="../reference/merge_by.html">merge_by()</a></code> is for creating district “cores”: gluing precincts in the “core” of an area together, to ensure that they stay together throughout redistricting. This has the effect of imposing a status quo constraint when applied to existing districts. Here, any precincts that are not within 1 precinct of the district borders will be merged into the district cores.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">houston_cores</span> <span class="op">=</span> <span class="va">houston_area</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cd_cores <span class="op">=</span> <span class="fu"><a href="../reference/redist.identify.cores.html">make_cores</a></span><span class="op">(</span>within<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="../reference/merge_by.html">merge_by</a></span><span class="op">(</span><span class="va">cd_cores</span>, drop_geom<span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">houston_cores</span><span class="op">)</span>
<span class="co">#&gt; A redist_map object with 475 units and 16 fields</span>
<span class="co">#&gt; To be partitioned into 6 districts with population between 698,224.4 - 5.0% and 698,224.4 + 5.0%</span>
<span class="co">#&gt; Merged from another map with reindexing: int [1:937] 360 358 358 371 358 ...</span>
<span class="co">#&gt; With geometry:</span>
<span class="co">#&gt;     bbox:           xmin: -8610.921 ymin: 687624.4 xmax: 94290.38 ymax: 788347.1</span>
<span class="co">#&gt;     projected CRS:  NAD83 / Conus Albers</span>
<span class="co">#&gt; # A tibble: 475 x 16</span>
<span class="co">#&gt; # Groups:   cd [6]</span>
<span class="co">#&gt;       cd cd_cores    pop black  hisp white   vap  bvap  hvap  wvap   dem   gop</span>
<span class="co">#&gt;  * &lt;int&gt;    &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1     2        1 123095  9046 18666 89688 88491  6079 11647 66980 14752 35624</span>
<span class="co">#&gt;  2     2        2  21385   687 15861  4093 15115   547 10347  3624  3900  1777</span>
<span class="co">#&gt;  3     2        3   5150   129  2638  2101  3874    95  1778  1778   701   810</span>
<span class="co">#&gt;  4     2        4   2833    89   496  1952  2521    78   416  1781  2399  1859</span>
<span class="co">#&gt;  5     2        5 130314 11627 24832 79357 94841  8059 15937 61024 17820 34377</span>
<span class="co">#&gt;  6     2        6   7947   367  1770  4016  5551   253  1114  2919  1169  1533</span>
<span class="co">#&gt;  7     2        7  16860  1803  4952  7013 12439  1286  3255  5668  3072  3232</span>
<span class="co">#&gt;  8     2        8   5394   437  1096  3608  3996   302   678  2854   831  1558</span>
<span class="co">#&gt;  9     2        9    678    23   139   354   641    23   119   343    50    15</span>
<span class="co">#&gt; 10     2       10   1656    52   136  1137  1337    45   115   929   514   240</span>
<span class="co">#&gt; # … with 465 more rows, and 4 more variables: county &lt;chr&gt;, id &lt;chr&gt;,</span>
<span class="co">#&gt; #   geometry &lt;GEOMETRY [m]&gt;, adj &lt;list&gt;</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">houston_cores</span>, centroids<span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<p><img src="tidy-redist_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
</div>
<div id="simulating-and-analyzing-plans" class="section level1">
<h1 class="hasAnchor">
<a href="#simulating-and-analyzing-plans" class="anchor"></a>Simulating and Analyzing Plans</h1>
<p>After preprocessing the map to focus on the redistricting problem of interest, we are ready to run the redistricting simulation. The recommended simulation function is <code><a href="../reference/redist_smc.html">redist_smc()</a></code>, which uses a Sequential Monte Carlo (SMC) algorithm.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">houston_plans</span> <span class="op">=</span> <span class="fu"><a href="../reference/redist_smc.html">redist_smc</a></span><span class="op">(</span><span class="va">houston_cores</span>, <span class="fl">100</span>, counties<span class="op">=</span><span class="va">county</span>, verbose<span class="op">=</span><span class="cn">F</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/add_reference.html">add_reference</a></span><span class="op">(</span><span class="va">houston_cores</span><span class="op">$</span><span class="va">cd</span><span class="op">)</span>
<span class="co">#&gt; SEQUENTIAL MONTE CARLO</span>
<span class="co">#&gt; Sampling 100 475-unit maps with 6 districts and population between 663313 and 733136.</span>
<span class="co">#&gt; Ensuring no more than 5 splits of the 6 administrative units.</span>
<span class="co">#&gt; Making split 1 of 5</span>
<span class="co">#&gt; Resampling effective sample size: 97.6 (97.6% efficiency).</span>
<span class="co">#&gt; Making split 2 of 5</span>
<span class="co">#&gt; Resampling effective sample size: 96.5 (96.5% efficiency).</span>
<span class="co">#&gt; Making split 3 of 5</span>
<span class="co">#&gt; Resampling effective sample size: 93.4 (93.4% efficiency).</span>
<span class="co">#&gt; Making split 4 of 5</span>
<span class="co">#&gt; Resampling effective sample size: 92.4 (92.4% efficiency).</span>
<span class="co">#&gt; Making split 5 of 5</span>
<span class="co">#&gt; Resampling effective sample size: 95.2 (95.2% efficiency).</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">houston_plans</span><span class="op">)</span>
<span class="co">#&gt; 100 sampled plans and 1 reference plan with 6 districts from a 475-unit map,</span>
<span class="co">#&gt;   drawn using Sequential Monte Carlo</span>
<span class="co">#&gt; Merged from another map with reindexing: int [1:937] 360 358 358 371 358 ...</span>
<span class="co">#&gt; With plans resampled from weights</span>
<span class="co">#&gt; Plans matrix: num [1:475, 1:101] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt; # A tibble: 606 x 3</span>
<span class="co">#&gt;    draw  district total_pop</span>
<span class="co">#&gt;    &lt;fct&gt;    &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 &lt;ref&gt;        1    705967</span>
<span class="co">#&gt;  2 &lt;ref&gt;        2    699765</span>
<span class="co">#&gt;  3 &lt;ref&gt;        3    697970</span>
<span class="co">#&gt;  4 &lt;ref&gt;        4    690022</span>
<span class="co">#&gt;  5 &lt;ref&gt;        5    701696</span>
<span class="co">#&gt;  6 &lt;ref&gt;        6    695465</span>
<span class="co">#&gt;  7 1            1    665633</span>
<span class="co">#&gt;  8 1            2    724768</span>
<span class="co">#&gt;  9 1            3    723278</span>
<span class="co">#&gt; 10 1            4    718261</span>
<span class="co">#&gt; # … with 596 more rows</span></code></pre></div>
<p>Since district numbers in simulated plans are by and large random, we often want to renumber the simulated districts to match the district numbers in the original plan, something which is easily accomplished by the function <code><a href="../reference/match_numbers.html">match_numbers()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">houston_plans</span> <span class="op">=</span> <span class="fu"><a href="../reference/match_numbers.html">match_numbers</a></span><span class="op">(</span><span class="va">houston_plans</span>, <span class="va">houston_cores</span><span class="op">$</span><span class="va">cd</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">houston_plans</span><span class="op">)</span>
<span class="co">#&gt; 100 sampled plans and 1 reference plan with 6 districts from a 475-unit map,</span>
<span class="co">#&gt;   drawn using Sequential Monte Carlo</span>
<span class="co">#&gt; Merged from another map with reindexing: int [1:937] 360 358 358 371 358 ...</span>
<span class="co">#&gt; With plans resampled from weights</span>
<span class="co">#&gt; Plans matrix: int [1:475, 1:101] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt; # A tibble: 606 x 4</span>
<span class="co">#&gt;    draw  district total_pop pop_overlap</span>
<span class="co">#&gt;    &lt;fct&gt; &lt;ord&gt;        &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1 &lt;ref&gt; 2           705967       1    </span>
<span class="co">#&gt;  2 &lt;ref&gt; 7           699765       1    </span>
<span class="co">#&gt;  3 &lt;ref&gt; 9           697970       1    </span>
<span class="co">#&gt;  4 &lt;ref&gt; 18          690022       1    </span>
<span class="co">#&gt;  5 &lt;ref&gt; 22          701696       1    </span>
<span class="co">#&gt;  6 &lt;ref&gt; 29          695465       1    </span>
<span class="co">#&gt;  7 1     22          665633       0.541</span>
<span class="co">#&gt;  8 1     18          724768       0.541</span>
<span class="co">#&gt;  9 1     9           723278       0.541</span>
<span class="co">#&gt; 10 1     7           718261       0.541</span>
<span class="co">#&gt; # … with 596 more rows</span></code></pre></div>
<p>This function also creates a new column, which records, for each plan, the fraction of the total population which lives in the same district under the reference plan.</p>
<p>We can then easily add summary statistics for each district. The <code><a href="../reference/redist.compactness.html">distr_compactness()</a></code> and <code><a href="../reference/redist.group.percent.html">group_frac()</a></code> functions will implicitly reference the simulated plans matrix when called inside <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">houston_plans</span> <span class="op">=</span> <span class="va">houston_plans</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>comp <span class="op">=</span> <span class="fu"><a href="../reference/redist.compactness.html">distr_compactness</a></span><span class="op">(</span><span class="va">houston_cores</span><span class="op">)</span>,
           pct_hisp <span class="op">=</span> <span class="fu"><a href="../reference/redist.group.percent.html">group_frac</a></span><span class="op">(</span><span class="va">houston_cores</span>, <span class="va">hvap</span>, <span class="va">vap</span><span class="op">)</span>,
           pct_black <span class="op">=</span> <span class="fu"><a href="../reference/redist.group.percent.html">group_frac</a></span><span class="op">(</span><span class="va">houston_cores</span>, <span class="va">bvap</span>, <span class="va">vap</span><span class="op">)</span>,
           pct_white <span class="op">=</span> <span class="fu"><a href="../reference/redist.group.percent.html">group_frac</a></span><span class="op">(</span><span class="va">houston_cores</span>, <span class="va">wvap</span>, <span class="va">vap</span><span class="op">)</span>,
           pct_min <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">pct_white</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">houston_plans</span><span class="op">)</span>
<span class="co">#&gt; 100 sampled plans and 1 reference plan with 6 districts from a 475-unit map,</span>
<span class="co">#&gt;   drawn using Sequential Monte Carlo</span>
<span class="co">#&gt; Merged from another map with reindexing: int [1:937] 360 358 358 371 358 ...</span>
<span class="co">#&gt; With plans resampled from weights</span>
<span class="co">#&gt; Plans matrix: int [1:475, 1:101] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt; # A tibble: 606 x 9</span>
<span class="co">#&gt;    draw  district total_pop pop_overlap  comp pct_hisp pct_black pct_white</span>
<span class="co">#&gt;    &lt;fct&gt; &lt;ord&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 &lt;ref&gt; 2           705967       1       874    0.273    0.0907     0.548</span>
<span class="co">#&gt;  2 &lt;ref&gt; 7           699765       1       874    0.271    0.107      0.509</span>
<span class="co">#&gt;  3 &lt;ref&gt; 9           697970       1       874    0.340    0.382      0.139</span>
<span class="co">#&gt;  4 &lt;ref&gt; 18          690022       1       874    0.344    0.405      0.201</span>
<span class="co">#&gt;  5 &lt;ref&gt; 22          701696       1       874    0.223    0.119      0.482</span>
<span class="co">#&gt;  6 &lt;ref&gt; 29          695465       1       874    0.729    0.0993     0.147</span>
<span class="co">#&gt;  7 1     22          665633       0.541   370    0.311    0.196      0.432</span>
<span class="co">#&gt;  8 1     18          724768       0.541   370    0.285    0.163      0.449</span>
<span class="co">#&gt;  9 1     9           723278       0.541   370    0.343    0.278      0.252</span>
<span class="co">#&gt; 10 1     7           718261       0.541   370    0.417    0.176      0.318</span>
<span class="co">#&gt; # … with 596 more rows, and 1 more variable: pct_min &lt;dbl&gt;</span></code></pre></div>
<p>If we wanted, we could sort and number districts according to one of these statistics using the <code><a href="../reference/number_by.html">number_by()</a></code> function.</p>
<p>From there, it’s easy to summarize summary statistics by plan.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">min_distr</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">houston_plans</span>, <span class="va">draw</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n_black <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pct_black</span> <span class="op">&gt;=</span> <span class="fl">0.5</span><span class="op">)</span>,
              n_hisp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pct_hisp</span> <span class="op">&gt;=</span> <span class="fl">0.5</span><span class="op">)</span>,
              n_coalition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pct_min</span> <span class="op">&gt;=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">min_distr</span><span class="op">)</span>
<span class="co">#&gt; 100 sampled plans and 1 reference plan with 6 districts from a 475-unit map,</span>
<span class="co">#&gt;   drawn using Sequential Monte Carlo</span>
<span class="co">#&gt; Merged from another map with reindexing: int [1:937] 360 358 358 371 358 ...</span>
<span class="co">#&gt; With plans resampled from weights</span>
<span class="co">#&gt; Plans matrix: int [1:475, 1:101] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">#&gt; # A tibble: 101 x 4</span>
<span class="co">#&gt;    draw  n_black n_hisp n_coalition</span>
<span class="co">#&gt;    &lt;fct&gt;   &lt;int&gt;  &lt;int&gt;       &lt;int&gt;</span>
<span class="co">#&gt;  1 &lt;ref&gt;       0      1           4</span>
<span class="co">#&gt;  2 1           0      1           6</span>
<span class="co">#&gt;  3 2           0      1           6</span>
<span class="co">#&gt;  4 3           0      1           6</span>
<span class="co">#&gt;  5 4           0      1           6</span>
<span class="co">#&gt;  6 5           0      1           6</span>
<span class="co">#&gt;  7 6           0      1           6</span>
<span class="co">#&gt;  8 7           0      1           6</span>
<span class="co">#&gt;  9 8           0      1           6</span>
<span class="co">#&gt; 10 9           0      1           6</span>
<span class="co">#&gt; # … with 91 more rows</span></code></pre></div>
<p>And <code>redist</code> provides several useful plotting functions. By default, <code>plot</code> calls <code>hist</code>, which makes a histogram of a quantity of interest along with a reference line for each reference plan.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ggplots with nice defaults and labels</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">min_distr</span>, <span class="va">n_coalition</span><span class="op">)</span></code></pre></div>
<p><img src="tidy-redist_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">houston_plans</span>, <span class="va">pct_hisp</span>, type<span class="op">=</span><span class="st">"distr_qtys"</span><span class="op">)</span></code></pre></div>
<p><img src="tidy-redist_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># don't sort; use existing district numbers</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">houston_plans</span>, <span class="va">pct_hisp</span>, sort<span class="op">=</span><span class="cn">F</span>, type<span class="op">=</span><span class="st">"distr_qtys"</span><span class="op">)</span></code></pre></div>
<p><img src="tidy-redist_files/figure-html/unnamed-chunk-11-3.png" width="700"></p>
<p>We can also re-index the plans back to the original, un-merged map.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">houston_orig_plans</span> <span class="op">=</span> <span class="fu"><a href="../reference/pullback.html">pullback</a></span><span class="op">(</span><span class="va">houston_plans</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">houston_orig_plans</span><span class="op">)</span>
<span class="co">#&gt; 100 sampled plans and 1 reference plan with 6 districts from a 937-unit map,</span>
<span class="co">#&gt;   drawn using Sequential Monte Carlo</span>
<span class="co">#&gt; With plans resampled from weights</span>
<span class="co">#&gt; Plans matrix: int [1:937, 1:101] 5 5 5 5 5 5 5 5 5 5 ...</span>
<span class="co">#&gt; # A tibble: 606 x 9</span>
<span class="co">#&gt;    draw  district total_pop pop_overlap  comp pct_hisp pct_black pct_white</span>
<span class="co">#&gt;    &lt;fct&gt; &lt;ord&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 &lt;ref&gt; 2           705967       1       874    0.273    0.0907     0.548</span>
<span class="co">#&gt;  2 &lt;ref&gt; 7           699765       1       874    0.271    0.107      0.509</span>
<span class="co">#&gt;  3 &lt;ref&gt; 9           697970       1       874    0.340    0.382      0.139</span>
<span class="co">#&gt;  4 &lt;ref&gt; 18          690022       1       874    0.344    0.405      0.201</span>
<span class="co">#&gt;  5 &lt;ref&gt; 22          701696       1       874    0.223    0.119      0.482</span>
<span class="co">#&gt;  6 &lt;ref&gt; 29          695465       1       874    0.729    0.0993     0.147</span>
<span class="co">#&gt;  7 1     22          665633       0.541   370    0.311    0.196      0.432</span>
<span class="co">#&gt;  8 1     18          724768       0.541   370    0.285    0.163      0.449</span>
<span class="co">#&gt;  9 1     9           723278       0.541   370    0.343    0.278      0.252</span>
<span class="co">#&gt; 10 1     7           718261       0.541   370    0.417    0.176      0.318</span>
<span class="co">#&gt; # … with 596 more rows, and 1 more variable: pct_min &lt;dbl&gt;</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">houston_orig_plans</span>, type<span class="op">=</span><span class="st">"plan"</span>, draw<span class="op">=</span><span class="fl">5</span>, geom<span class="op">=</span><span class="va">houston_area</span><span class="op">)</span></code></pre></div>
<p><img src="tidy-redist_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div id="all-together" class="section level1">
<h1 class="hasAnchor">
<a href="#all-together" class="anchor"></a>All Together</h1>
<p>A minimum working example for the ‘signature of gerrymandering’.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">houston</span> <span class="op">=</span> <span class="va">east_tx</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/redist_map.html">redist_map</a></span><span class="op">(</span>pop_tol<span class="op">=</span><span class="fl">0.05</span>, existing_plan<span class="op">=</span><span class="va">cd</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cd</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">7</span>, <span class="fl">9</span>, <span class="fl">18</span>, <span class="fl">22</span>, <span class="fl">29</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># filter to Houston area</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cd_cores <span class="op">=</span> <span class="fu"><a href="../reference/redist.identify.cores.html">make_cores</a></span><span class="op">(</span>within<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/merge_by.html">merge_by</a></span><span class="op">(</span><span class="va">cd_cores</span><span class="op">)</span>

<span class="va">houston_plans</span> <span class="op">=</span> <span class="fu"><a href="../reference/redist_smc.html">redist_smc</a></span><span class="op">(</span><span class="va">houston</span>, <span class="fl">100</span>, counties<span class="op">=</span><span class="va">county</span>, silent<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span>    
    <span class="fu"><a href="../reference/add_reference.html">add_reference</a></span><span class="op">(</span><span class="va">houston</span><span class="op">$</span><span class="va">cd</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/match_numbers.html">match_numbers</a></span><span class="op">(</span><span class="va">houston</span><span class="op">$</span><span class="va">cd</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pct_hisp <span class="op">=</span> <span class="fu"><a href="../reference/redist.group.percent.html">group_frac</a></span><span class="op">(</span><span class="va">houston</span>, <span class="va">hvap</span>, <span class="va">vap</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">houston_plans</span>, <span class="va">pct_hisp</span>, type<span class="op">=</span><span class="st">"distr_qtys"</span><span class="op">)</span></code></pre></div>
<p><img src="tidy-redist_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>McCartan, C., &amp; Imai, K. (2020). Sequential Monte Carlo for Sampling Balanced and Compact Redistricting Plans. Available at <a href="https://imai.fas.harvard.edu/research/files/SMCredist.pdf" class="uri">https://imai.fas.harvard.edu/research/files/SMCredist.pdf</a>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ben Fifield, Christopher T. Kenny, Cory McCartan, Jun Kawahara, Kosuke Imai.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
